<div id="addIngredientModal" class="modal">
  <div class="modal-content">
    <h3>Add Ingredient</h3>
    <form
      id="addIngredientForm"
      action="{% url 'shoppinglist:add_ingredient_to_buy' list_id=1 %}"
      method="POST"
      onsubmit="submitForm(event)"
    >
      {{ form.media }} {% csrf_token %}
      <label for="ingredient">Ingredient</label>
      <select id="ingredient" name="ingredient" required>
        {% for ingredient in ingredients %}
        <option value="{{ ingredient.ingredient_id }}">{{ ingredient.name }}</option>
        {% endfor %}
      </select>

      <label for="quantity">Quantity</label>
      <input type="number" id="quantity" name="quantity" required />

      <div class="modal-btn-container">
        <button type="button" class="btn-close btn-primary" onclick="closeModal()">Close</button>
        <button type="submit" class="btn-submit btn-primary">Add Ingredient</button>
      </div>
    </form>
  </div>
</div>

<script>
  function verifyIngredientSelection() {
    const ingredientSelect = document.getElementById("ingredient");
    console.log(ingredientSelect.value); // Check the value of the selected ingredient
  }

  const modal = document.querySelector(".modal");
  const addButton = document.querySelector(".add-btn");

  function openModal() {
    modal.classList.add("show");
  }

  function closeModal() {
    modal.classList.remove("show");
  }

  addButton.addEventListener("click", openModal);

  window.onclick = function (event) {
    if (event.target === modal) {
      closeModal();
    }
  };

  const closeButton = modal.querySelector(".close-btn");
  if (closeButton) {
    closeButton.addEventListener("click", closeModal);
  }

  function resetFormValues() {
    const form = document.getElementById("addIngredientForm");

    form.reset();

    const ingredientSelect = document.getElementById("ingredient");
    ingredientSelect.value = "";

    const quantityInput = document.getElementById("quantity");
    quantityInput.value = "";
  }

  function submitForm(event) {
    event.preventDefault();

    const form = document.getElementById("addIngredientForm");
    const formData = new FormData(form);

    for (let [key, value] of formData.entries()) {
      console.log(key + ": " + value);
    }

    fetch(form.action, {
      method: "POST",
      body: formData,
    })
      .then((response) => response.json())
      .then((data) => {
        console.log(data);
        if (data.success) {
          closeModal();
          resetFormValues();
          alert(`Ingredient ${data.ingredient_name} added with quantity ${data.quantity}`);
          window.location.reload();
        } else {
          alert("Error adding ingredient.");
        }
      })
      .catch((error) => {
        console.error("Error:", error);
        alert("An error occurred.");
      });
  }
</script>
